<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>12 O'Clock Cake Shop — ERP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&family=Lexend:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" />
  <style>
    :root {
      --bg-base: #f0eeeb;
      --bg-card: #fafaf8;
      --bg-card-inner: #f5f4f1;
      --bg-sidebar: #1a1a1a;
      --bg-sidebar-hover: #2a2a2a;
      --text-primary: #111111;
      --text-secondary: #555555;
      --text-muted: #999999;
      --text-light: #ffffff;
      --border-light: #e0deda;
      --border-medium: #c8c5bf;
      --accent: #1a1a1a;
      --accent-light: #333333;
      --danger: #c0392b;
      --success: #27ae60;
      --warning: #e67e22;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.10), 0 4px 8px rgba(0,0,0,0.05);
      --shadow-inset: inset 0 2px 4px rgba(0,0,0,0.06), inset 0 1px 2px rgba(0,0,0,0.04);
      --shadow-raised: 0 2px 0 rgba(255,255,255,0.8), 0 4px 8px rgba(0,0,0,0.10);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --font-display: 'Sora', sans-serif;
      --font-body: 'Poppins', sans-serif;
      --font-ui: 'Lexend', sans-serif;
      --sidebar-width: 260px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: var(--font-body);
      background: var(--bg-base);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.6;
    }

    /* ── LAYOUT ─────────────────────────────── */
    #app { display: flex; min-height: 100vh; }

    /* ── SIDEBAR ─────────────────────────────── */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-sidebar);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0; left: 0;
      height: 100vh;
      z-index: 1000;
      transition: transform 0.3s ease;
      overflow-y: auto;
    }

    .sidebar-brand {
      padding: 28px 24px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .sidebar-brand .brand-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px; height: 40px;
      background: #fff;
      color: #111;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 800;
      font-family: var(--font-display);
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(255,255,255,0.15);
    }

    .sidebar-brand h1 {
      font-family: var(--font-display);
      font-size: 15px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.02em;
      line-height: 1.3;
    }

    .sidebar-brand p {
      font-family: var(--font-ui);
      font-size: 11px;
      color: rgba(255,255,255,0.45);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-top: 2px;
    }

    .sidebar-nav { padding: 16px 12px; flex: 1; }

    .nav-section-label {
      font-family: var(--font-ui);
      font-size: 9.5px;
      font-weight: 600;
      color: rgba(255,255,255,0.3);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 12px 12px 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 14px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-family: var(--font-ui);
      font-size: 13.5px;
      font-weight: 400;
      color: rgba(255,255,255,0.55);
      transition: all 0.18s ease;
      margin-bottom: 2px;
      letter-spacing: 0.01em;
      user-select: none;
    }

    .nav-item i {
      width: 18px;
      text-align: center;
      font-size: 14px;
      opacity: 0.7;
      transition: opacity 0.18s;
    }

    .nav-item:hover {
      background: var(--bg-sidebar-hover);
      color: rgba(255,255,255,0.85);
    }

    .nav-item.active {
      background: rgba(255,255,255,0.09);
      color: #fff;
      font-weight: 500;
    }

    .nav-item.active i { opacity: 1; }

    .sidebar-footer {
      padding: 16px 24px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }

    .sidebar-footer p {
      font-family: var(--font-ui);
      font-size: 11px;
      color: rgba(255,255,255,0.25);
      letter-spacing: 0.04em;
    }

    /* ── MAIN CONTENT ─────────────────────────────── */
    .main-content {
      margin-left: var(--sidebar-width);
      flex: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── TOPBAR ─────────────────────────────── */
    .topbar {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-light);
      padding: 0 32px;
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-sm);
    }

    .topbar-left { display: flex; align-items: center; gap: 14px; }

    .sidebar-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 18px;
      cursor: pointer;
      padding: 6px;
    }

    .page-title {
      font-family: var(--font-display);
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }

    .page-subtitle {
      font-family: var(--font-ui);
      font-size: 11.5px;
      color: var(--text-muted);
      letter-spacing: 0.03em;
    }

    .topbar-right { display: flex; align-items: center; gap: 12px; }

    .topbar-date {
      font-family: var(--font-ui);
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 0.03em;
    }

    /* ── PAGE BODY ─────────────────────────────── */
    .page-body { padding: 28px 32px; flex: 1; }
    .page { display: none; }
    .page.active { display: block; }

    /* ── SKEUOMORPHIC CARD ─────────────────────────────── */
    .sku-card {
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-raised);
      position: relative;
      overflow: hidden;
    }

    .sku-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: rgba(255,255,255,0.9);
    }

    .card-pad { padding: 24px 28px; }
    .card-pad-sm { padding: 16px 20px; }

    /* ── STAT CARDS ─────────────────────────────── */
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 22px 24px;
      box-shadow: var(--shadow-raised);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: rgba(255,255,255,0.9);
    }

    .stat-card::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 1px;
      background: rgba(0,0,0,0.04);
    }

    .stat-icon {
      width: 42px; height: 42px;
      border-radius: 10px;
      background: var(--bg-card-inner);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-inset);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
      color: var(--text-secondary);
      margin-bottom: 14px;
    }

    .stat-value {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.02em;
      line-height: 1.1;
    }

    .stat-label {
      font-family: var(--font-ui);
      font-size: 11.5px;
      color: var(--text-muted);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-top: 4px;
    }

    /* ── SECTION HEADER ─────────────────────────────── */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .section-title {
      font-family: var(--font-display);
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }

    .section-subtitle {
      font-family: var(--font-ui);
      font-size: 11.5px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* ── BUTTONS ─────────────────────────────── */
    .btn-sku {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: var(--radius-sm);
      font-family: var(--font-ui);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.15s ease;
      letter-spacing: 0.02em;
      line-height: 1;
      user-select: none;
    }

    .btn-sku-primary {
      background: var(--bg-sidebar);
      color: #fff;
      box-shadow: 0 1px 0 rgba(255,255,255,0.08) inset, 0 3px 8px rgba(0,0,0,0.25);
    }

    .btn-sku-primary:hover {
      background: #2a2a2a;
      box-shadow: 0 1px 0 rgba(255,255,255,0.08) inset, 0 4px 12px rgba(0,0,0,0.3);
    }

    .btn-sku-primary:active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .btn-sku-secondary {
      background: var(--bg-card);
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
      box-shadow: var(--shadow-raised);
    }

    .btn-sku-secondary:hover {
      background: var(--bg-card-inner);
      color: var(--text-primary);
    }

    .btn-sku-danger {
      background: #fff0ee;
      color: var(--danger);
      border: 1px solid #ffd5cf;
      box-shadow: var(--shadow-sm);
    }

    .btn-sku-danger:hover { background: #ffe8e4; }

    .btn-sku-success {
      background: #edfaf3;
      color: var(--success);
      border: 1px solid #c5edd8;
      box-shadow: var(--shadow-sm);
    }

    .btn-sku-sm { padding: 7px 14px; font-size: 12px; }

    /* ── FORM ELEMENTS ─────────────────────────────── */
    .form-label-sku {
      font-family: var(--font-ui);
      font-size: 11.5px;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 6px;
      display: block;
    }

    .input-sku {
      width: 100%;
      background: var(--bg-card-inner);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      font-family: var(--font-body);
      font-size: 13.5px;
      color: var(--text-primary);
      box-shadow: var(--shadow-inset);
      transition: all 0.15s ease;
      outline: none;
    }

    .input-sku:focus {
      border-color: #888;
      box-shadow: var(--shadow-inset), 0 0 0 3px rgba(0,0,0,0.06);
      background: #fff;
    }

    .input-sku::placeholder { color: var(--text-muted); }

    select.input-sku {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 32px;
    }

    /* ── TABLE ─────────────────────────────── */
    .sku-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .sku-table thead th {
      font-family: var(--font-ui);
      font-size: 10.5px;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 12px 16px;
      background: var(--bg-card-inner);
      border-bottom: 1px solid var(--border-light);
      white-space: nowrap;
    }

    .sku-table thead th:first-child { border-radius: var(--radius-sm) 0 0 0; }
    .sku-table thead th:last-child { border-radius: 0 var(--radius-sm) 0 0; }

    .sku-table tbody tr {
      transition: background 0.12s;
    }

    .sku-table tbody tr:hover { background: #faf9f7; }

    .sku-table tbody td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-light);
      font-family: var(--font-body);
      font-size: 13.5px;
      color: var(--text-primary);
      vertical-align: middle;
    }

    .sku-table tbody tr:last-child td { border-bottom: none; }

    /* ── BADGE ─────────────────────────────── */
    .badge-sku {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 99px;
      font-family: var(--font-ui);
      font-size: 10.5px;
      font-weight: 500;
      letter-spacing: 0.04em;
    }

    .badge-cake { background: #fdf3e3; color: #b7620c; border: 1px solid #f5d9b0; }
    .badge-choc { background: #f5eee8; color: #7b4520; border: 1px solid #e8cfbc; }
    .badge-icecream { background: #e8f4fd; color: #1a6fa8; border: 1px solid #b8ddf5; }

    /* ── BILLING ─────────────────────────────── */
    .billing-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 20px;
      align-items: start;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(155px, 1fr));
      gap: 10px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .product-btn {
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 14px 12px;
      cursor: pointer;
      text-align: left;
      transition: all 0.15s;
      box-shadow: var(--shadow-raised);
      user-select: none;
    }

    .product-btn:hover {
      border-color: #aaa;
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .product-btn:active { transform: translateY(0); }

    .product-btn .p-name {
      font-family: var(--font-body);
      font-size: 12.5px;
      font-weight: 500;
      color: var(--text-primary);
      line-height: 1.3;
      margin-bottom: 6px;
    }

    .product-btn .p-price {
      font-family: var(--font-display);
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .product-btn .p-price span {
      font-size: 11px;
      font-weight: 400;
      color: var(--text-muted);
      font-family: var(--font-ui);
    }

    .product-btn .p-cat {
      display: inline-block;
      font-family: var(--font-ui);
      font-size: 9.5px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
    }

    /* Bill Panel */
    .bill-panel {
      position: sticky;
      top: 96px;
    }

    .bill-items { max-height: 280px; overflow-y: auto; }

    .bill-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 9px 0;
      border-bottom: 1px solid var(--border-light);
    }

    .bill-row:last-child { border-bottom: none; }

    .bill-row-name {
      flex: 1;
      font-family: var(--font-body);
      font-size: 12.5px;
      color: var(--text-primary);
    }

    .bill-row-qty {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .qty-btn {
      width: 24px; height: 24px;
      border-radius: 6px;
      background: var(--bg-card-inner);
      border: 1px solid var(--border-medium);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 13px;
      color: var(--text-secondary);
      box-shadow: var(--shadow-sm);
      transition: all 0.12s;
      user-select: none;
    }

    .qty-btn:hover { background: #e8e6e0; }

    .qty-val {
      font-family: var(--font-display);
      font-size: 13px;
      font-weight: 600;
      width: 22px;
      text-align: center;
    }

    .bill-row-total {
      font-family: var(--font-display);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      min-width: 56px;
      text-align: right;
    }

    .bill-row-del {
      width: 22px; height: 22px;
      border-radius: 5px;
      background: none;
      border: none;
      cursor: pointer;
      color: #ccc;
      font-size: 11px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.12s;
    }

    .bill-row-del:hover { color: var(--danger); background: #fff0ee; }

    .bill-total-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0 0;
    }

    .bill-total-label {
      font-family: var(--font-ui);
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .bill-total-val {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.02em;
    }

    /* Customer */
    .customer-section {
      border-bottom: 1px solid var(--border-light);
      padding-bottom: 16px;
      margin-bottom: 16px;
    }

    /* ── SCROLLBAR ─────────────────────────────── */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-medium); border-radius: 99px; }

    /* ── MODAL ─────────────────────────────── */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(2px);
    }

    .modal-overlay.open { display: flex; }

    .modal-box {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: 28px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      border: 1px solid var(--border-light);
      position: relative;
    }

    .modal-box::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 1px;
      background: rgba(255,255,255,0.9);
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    }

    .modal-title {
      font-family: var(--font-display);
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 20px;
      letter-spacing: -0.01em;
    }

    /* ── DIVIDER ─────────────────────────────── */
    .divider {
      height: 1px;
      background: var(--border-light);
      margin: 20px 0;
    }

    /* ── TOAST ─────────────────────────────── */
    #toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast-msg {
      background: #1a1a1a;
      color: #fff;
      font-family: var(--font-ui);
      font-size: 13px;
      padding: 12px 18px;
      border-radius: var(--radius-sm);
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
      animation: toastIn 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast-msg.success i { color: #4ade80; }
    .toast-msg.error i { color: #f87171; }

    @keyframes toastIn {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* ── EMPTY STATE ─────────────────────────────── */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .empty-state i {
      font-size: 32px;
      opacity: 0.25;
      margin-bottom: 12px;
      display: block;
    }

    .empty-state p {
      font-family: var(--font-ui);
      font-size: 13px;
    }

    /* ── SEARCH BAR ─────────────────────────────── */
    .search-wrap {
      position: relative;
    }

    .search-wrap i {
      position: absolute;
      left: 13px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 13px;
    }

    .search-wrap input {
      padding-left: 36px;
    }

    /* ── CATEGORY FILTER ─────────────────────────────── */
    .cat-filter {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .cat-chip {
      padding: 6px 14px;
      border-radius: 99px;
      font-family: var(--font-ui);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid var(--border-medium);
      background: var(--bg-card);
      color: var(--text-secondary);
      box-shadow: var(--shadow-sm);
      transition: all 0.15s;
      user-select: none;
    }

    .cat-chip:hover { background: var(--bg-card-inner); }

    .cat-chip.active {
      background: var(--bg-sidebar);
      color: #fff;
      border-color: var(--bg-sidebar);
    }

    /* ── BILL RECEIPT PRINT ─────────────────────────────── */
    @media print {
      .sidebar, .topbar, .no-print { display: none !important; }
      .main-content { margin-left: 0 !important; }
      .page-body { padding: 0 !important; }
      .page { display: block !important; }
      #receipt-print-area {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        width: 300px;
        margin: 0 auto;
      }
    }

    /* ── RESPONSIVE ─────────────────────────────── */
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; }
      .sidebar-toggle { display: flex !important; }
      .page-body { padding: 16px; }
      .topbar { padding: 0 16px; }
      .billing-grid { grid-template-columns: 1fr; }
      .bill-panel { position: static; }
    }

    .sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }

    .sidebar-backdrop.open { display: block; }

    /* ── INVOICE HEADER ─────────────────────────────── */
    .invoice-header {
      background: var(--bg-sidebar);
      color: #fff;
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .invoice-shop-name {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 800;
      letter-spacing: -0.01em;
    }

    .invoice-shop-sub {
      font-family: var(--font-ui);
      font-size: 10.5px;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.06em;
      margin-top: 2px;
    }

    .invoice-no {
      font-family: var(--font-display);
      font-size: 13px;
      color: rgba(255,255,255,0.6);
      text-align: right;
    }

    .invoice-no strong {
      display: block;
      font-size: 16px;
      color: #fff;
    }

    /* ── RECENT BILLS ─────────────────────────────── */
    .bill-history-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border-light);
      cursor: pointer;
      transition: background 0.12s;
    }

    .bill-history-item:last-child { border-bottom: none; }
    .bill-history-item:hover { background: var(--bg-card-inner); }

    .bill-hist-icon {
      width: 36px; height: 36px;
      border-radius: 9px;
      background: var(--bg-card-inner);
      border: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      color: var(--text-muted);
      box-shadow: var(--shadow-inset);
      flex-shrink: 0;
    }

    .bill-hist-info { flex: 1; min-width: 0; }

    .bill-hist-name {
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .bill-hist-meta {
      font-family: var(--font-ui);
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .bill-hist-amount {
      font-family: var(--font-display);
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* ── PRODUCT CATEGORY COLOR DOT ─────────────────────────────── */
    .cat-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .cat-dot-cake { background: #e6890a; }
    .cat-dot-chocolate { background: #7b4520; }
    .cat-dot-icecream { background: #1a6fa8; }
  </style>
</head>
<body>

<div id="app">

  <!-- SIDEBAR BACKDROP -->
  <div class="sidebar-backdrop" id="sidebarBackdrop" onclick="toggleSidebar()"></div>

  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <div class="brand-badge">12</div>
      <h1>12 O'Clock</h1>
      <p>Cake Shop — ERP</p>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Main</div>
      <div class="nav-item active" onclick="showPage('dashboard')">
        <i class="fa-solid fa-chart-pie"></i>
        Dashboard
      </div>
      <div class="nav-item" onclick="showPage('billing')">
        <i class="fa-solid fa-receipt"></i>
        New Bill
      </div>
      <div class="nav-section-label" style="margin-top:10px;">Manage</div>
      <div class="nav-item" onclick="showPage('inventory')">
        <i class="fa-solid fa-boxes-stacked"></i>
        Inventory
      </div>
      <div class="nav-item" onclick="showPage('products')">
        <i class="fa-solid fa-tag"></i>
        Products & Pricing
      </div>
      <div class="nav-item" onclick="showPage('bills')">
        <i class="fa-solid fa-clock-rotate-left"></i>
        Bill History
      </div>
    </div>
    <div class="sidebar-footer">
      <p>WebMint Solutions</p>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main-content">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-left">
        <button class="sidebar-toggle" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></button>
        <div>
          <div class="page-title" id="topbarTitle">Dashboard</div>
          <div class="page-subtitle" id="topbarSub">Overview of today's operations</div>
        </div>
      </div>
      <div class="topbar-right">
        <span class="topbar-date" id="topbarDate"></span>
      </div>
    </header>

    <div class="page-body">

      <!-- ========== DASHBOARD ========== -->
      <div class="page active" id="page-dashboard">
        <!-- Stats -->
        <div class="row g-3 mb-4">
          <div class="col-6 col-md-3">
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-indian-rupee-sign"></i></div>
              <div class="stat-value" id="stat-revenue">0</div>
              <div class="stat-label">Today's Revenue</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-receipt"></i></div>
              <div class="stat-value" id="stat-bills">0</div>
              <div class="stat-label">Bills Today</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-cubes"></i></div>
              <div class="stat-value" id="stat-items">0</div>
              <div class="stat-label">Items Sold</div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="stat-card">
              <div class="stat-icon"><i class="fa-solid fa-tag"></i></div>
              <div class="stat-value" id="stat-products">0</div>
              <div class="stat-label">Total Products</div>
            </div>
          </div>
        </div>

        <div class="row g-3">
          <!-- Recent Bills -->
          <div class="col-md-7">
            <div class="sku-card">
              <div class="card-pad" style="padding-bottom: 12px; border-bottom: 1px solid var(--border-light);">
                <div class="section-header" style="margin-bottom:0">
                  <div>
                    <div class="section-title">Recent Bills</div>
                    <div class="section-subtitle">Latest transactions</div>
                  </div>
                  <button class="btn-sku btn-sku-secondary btn-sku-sm" onclick="showPage('bills')">
                    <i class="fa-solid fa-arrow-right"></i> View All
                  </button>
                </div>
              </div>
              <div id="dash-recent-bills"></div>
            </div>
          </div>

          <!-- Top Products -->
          <div class="col-md-5">
            <div class="sku-card">
              <div class="card-pad" style="padding-bottom: 12px; border-bottom: 1px solid var(--border-light);">
                <div class="section-title">Product Catalogue</div>
                <div class="section-subtitle">All active products</div>
              </div>
              <div style="padding: 12px 0;" id="dash-products"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== BILLING ========== -->
      <div class="page" id="page-billing">
        <div class="billing-grid">

          <!-- Left: Product Picker -->
          <div>
            <div class="sku-card card-pad mb-3">
              <div class="section-header">
                <div>
                  <div class="section-title">Select Products</div>
                  <div class="section-subtitle">Tap to add to bill</div>
                </div>
              </div>
              <!-- Category Filter -->
              <div class="cat-filter mb-3" id="bill-cat-filter">
                <div class="cat-chip active" data-cat="all">All</div>
              </div>
              <!-- Product Grid -->
              <div class="product-grid" id="product-grid"></div>
            </div>
          </div>

          <!-- Right: Bill Panel -->
          <div class="bill-panel">
            <div class="sku-card">
              <div class="invoice-header">
                <div>
                  <div class="invoice-shop-name">12 O'Clock</div>
                  <div class="invoice-shop-sub">CAKE SHOP</div>
                </div>
                <div class="invoice-no">
                  Bill No.
                  <strong id="bill-no-display">#001</strong>
                </div>
              </div>

              <div class="card-pad">
                <!-- Customer -->
                <div class="customer-section">
                  <div class="row g-2">
                    <div class="col-8">
                      <label class="form-label-sku">Customer Name</label>
                      <input type="text" class="input-sku" id="cust-name" placeholder="Walk-in Customer" />
                    </div>
                    <div class="col-4">
                      <label class="form-label-sku">Phone</label>
                      <input type="text" class="input-sku" id="cust-phone" placeholder="Optional" />
                    </div>
                  </div>
                </div>

                <!-- Bill Items -->
                <div class="bill-items" id="bill-items">
                  <div class="empty-state" id="bill-empty">
                    <i class="fa-solid fa-bag-shopping"></i>
                    <p>No items added yet</p>
                  </div>
                </div>

                <!-- Total -->
                <div class="divider"></div>
                <div class="bill-total-row">
                  <span class="bill-total-label">Total Amount</span>
                  <span class="bill-total-val"><span style="font-size:14px;opacity:0.5">&#8377;</span> <span id="bill-total">0.00</span></span>
                </div>

                <div class="divider"></div>

                <!-- Actions -->
                <div class="d-flex gap-2">
                  <button class="btn-sku btn-sku-secondary btn-sku-sm flex-grow-1" onclick="clearBill()">
                    <i class="fa-solid fa-trash"></i> Clear
                  </button>
                  <button class="btn-sku btn-sku-primary flex-grow-1" onclick="saveBillAndPrint()">
                    <i class="fa-solid fa-print"></i> Save & Print
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== INVENTORY ========== -->
      <div class="page" id="page-inventory">
        <div class="sku-card">
          <div class="card-pad" style="border-bottom:1px solid var(--border-light); padding-bottom:16px;">
            <div class="section-header" style="margin-bottom:0">
              <div>
                <div class="section-title">Inventory Overview</div>
                <div class="section-subtitle">Track stock levels per product</div>
              </div>
              <button class="btn-sku btn-sku-primary" onclick="openUpdateStockModal()">
                <i class="fa-solid fa-plus"></i> Update Stock
              </button>
            </div>
          </div>

          <div class="card-pad" style="padding-top:16px; padding-bottom:16px; border-bottom:1px solid var(--border-light);">
            <div class="row g-2">
              <div class="col-md-6">
                <div class="search-wrap">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" class="input-sku" id="inv-search" placeholder="Search products..." oninput="renderInventory()" />
                </div>
              </div>
              <div class="col-md-6">
                <select class="input-sku" id="inv-cat-filter" onchange="renderInventory()">
                  <option value="all">All Categories</option>
                  <option value="Cake">Cake</option>
                  <option value="Chocolate">Chocolate</option>
                  <option value="Ice Cream">Ice Cream</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table class="sku-table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Price / Pc</th>
                  <th>Stock (Pcs)</th>
                  <th>Stock Value</th>
                  <th>Status</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="inventory-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ========== PRODUCTS ========== -->
      <div class="page" id="page-products">
        <div class="row g-3">
          <div class="col-md-8">
            <div class="sku-card">
              <div class="card-pad" style="border-bottom:1px solid var(--border-light); padding-bottom:16px;">
                <div class="section-header" style="margin-bottom:0">
                  <div>
                    <div class="section-title">Products & Pricing</div>
                    <div class="section-subtitle">Manage your product catalogue</div>
                  </div>
                  <button class="btn-sku btn-sku-primary" onclick="openProductModal()">
                    <i class="fa-solid fa-plus"></i> Add Product
                  </button>
                </div>
              </div>

              <div class="card-pad" style="padding-top:16px; padding-bottom:16px; border-bottom:1px solid var(--border-light);">
                <div class="search-wrap">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" class="input-sku" id="prod-search" placeholder="Search products..." oninput="renderProductsTable()" />
                </div>
              </div>

              <div class="table-responsive">
                <table class="sku-table">
                  <thead>
                    <tr>
                      <th>Product Name</th>
                      <th>Category</th>
                      <th>Unit</th>
                      <th>Price</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="products-tbody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="sku-card card-pad">
              <div class="section-title mb-3">Category Summary</div>
              <div id="cat-summary"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== BILL HISTORY ========== -->
      <div class="page" id="page-bills">
        <div class="sku-card">
          <div class="card-pad" style="border-bottom:1px solid var(--border-light); padding-bottom:16px;">
            <div class="section-header" style="margin-bottom:0">
              <div>
                <div class="section-title">Bill History</div>
                <div class="section-subtitle">All saved bills</div>
              </div>
              <div class="d-flex gap-2">
                <button class="btn-sku btn-sku-danger btn-sku-sm" onclick="confirmClearAllBills()">
                  <i class="fa-solid fa-trash"></i> Clear All
                </button>
              </div>
            </div>
          </div>

          <div class="card-pad" style="padding-top:16px; padding-bottom:16px; border-bottom:1px solid var(--border-light);">
            <div class="search-wrap">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input type="text" class="input-sku" id="bill-hist-search" placeholder="Search by customer, bill no..." oninput="renderBillHistory()" />
            </div>
          </div>

          <div class="table-responsive">
            <table class="sku-table">
              <thead>
                <tr>
                  <th>Bill No.</th>
                  <th>Customer</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Date & Time</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="bills-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div><!-- end page-body -->
  </div><!-- end main-content -->
</div><!-- end app -->

<!-- ========== TOAST ========== -->
<div id="toast-container"></div>

<!-- ========== MODALS ========== -->

<!-- Product Modal -->
<div class="modal-overlay" id="productModal">
  <div class="modal-box">
    <div class="modal-title" id="productModalTitle">Add New Product</div>
    <input type="hidden" id="edit-product-id" />
    <div class="row g-3">
      <div class="col-12">
        <label class="form-label-sku">Product Name</label>
        <input type="text" class="input-sku" id="prod-name-input" placeholder="e.g. Black Forest" />
      </div>
      <div class="col-6">
        <label class="form-label-sku">Category</label>
        <select class="input-sku" id="prod-cat-input">
          <option value="Cake">Cake</option>
          <option value="Chocolate">Chocolate</option>
          <option value="Ice Cream">Ice Cream</option>
        </select>
      </div>
      <div class="col-6">
        <label class="form-label-sku">Unit</label>
        <select class="input-sku" id="prod-unit-input">
          <option value="pcs">Per Piece</option>
          <option value="kg">Per Kg</option>
          <option value="box">Per Box</option>
          <option value="cup">Per Cup</option>
        </select>
      </div>
      <div class="col-6">
        <label class="form-label-sku">Price (&#8377;)</label>
        <input type="number" class="input-sku" id="prod-price-input" placeholder="0.00" min="0" step="0.5" />
      </div>
      <div class="col-6">
        <label class="form-label-sku">Initial Stock</label>
        <input type="number" class="input-sku" id="prod-stock-input" placeholder="0" min="0" />
      </div>
    </div>
    <div class="divider"></div>
    <div class="d-flex gap-2 justify-content-end">
      <button class="btn-sku btn-sku-secondary" onclick="closeProductModal()">Cancel</button>
      <button class="btn-sku btn-sku-primary" onclick="saveProduct()"><i class="fa-solid fa-check"></i> Save Product</button>
    </div>
  </div>
</div>

<!-- Update Stock Modal -->
<div class="modal-overlay" id="stockModal">
  <div class="modal-box">
    <div class="modal-title">Update Stock</div>
    <div class="mb-3">
      <label class="form-label-sku">Select Product</label>
      <select class="input-sku" id="stock-prod-select"></select>
    </div>
    <div class="mb-3">
      <label class="form-label-sku">Adjustment Type</label>
      <select class="input-sku" id="stock-type">
        <option value="add">Add Stock</option>
        <option value="set">Set Exact Stock</option>
        <option value="remove">Remove Stock</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label-sku">Quantity (Pieces)</label>
      <input type="number" class="input-sku" id="stock-qty" min="0" placeholder="0" />
    </div>
    <div class="divider"></div>
    <div class="d-flex gap-2 justify-content-end">
      <button class="btn-sku btn-sku-secondary" onclick="closeStockModal()">Cancel</button>
      <button class="btn-sku btn-sku-primary" onclick="saveStock()"><i class="fa-solid fa-check"></i> Update Stock</button>
    </div>
  </div>
</div>

<!-- Bill Detail Modal -->
<div class="modal-overlay" id="billDetailModal">
  <div class="modal-box" style="max-width:520px">
    <div class="modal-title">Bill Details</div>
    <div id="bill-detail-content"></div>
    <div class="divider"></div>
    <div class="d-flex gap-2 justify-content-end">
      <button class="btn-sku btn-sku-secondary" onclick="closeBillDetail()">Close</button>
      <button class="btn-sku btn-sku-primary" onclick="printCurrentBillDetail()"><i class="fa-solid fa-print"></i> Print</button>
    </div>
  </div>
</div>

<!-- Print Area (hidden) -->
<div id="receipt-print-area" style="display:none;"></div>

<script>
// ── DATA ──────────────────────────────────────────────

const DEFAULT_PRODUCTS = [
  { id: 'p1', name: 'Black Forest',  category: 'Cake',      price: 60, unit: 'pcs', stock: 20 },
  { id: 'p2', name: 'Red Velvet',    category: 'Cake',      price: 70, unit: 'pcs', stock: 15 },
  { id: 'p3', name: 'German Choco',  category: 'Cake',      price: 75, unit: 'pcs', stock: 12 },
  { id: 'p4', name: 'Dairy Milk',    category: 'Chocolate', price: 50, unit: 'pcs', stock: 30 },
  { id: 'p5', name: 'Kit Kat',       category: 'Chocolate', price: 40, unit: 'pcs', stock: 25 },
  { id: 'p6', name: 'Vanilla',       category: 'Ice Cream', price: 25, unit: 'pcs', stock: 40 },
  { id: 'p7', name: 'Strawberry',    category: 'Ice Cream', price: 30, unit: 'pcs', stock: 35 },
  { id: 'p8', name: 'Chocolate',     category: 'Ice Cream', price: 30, unit: 'pcs', stock: 35 },
  { id: 'p9', name: 'Butterscotch',  category: 'Ice Cream', price: 35, unit: 'pcs', stock: 28 },
];

function loadData(key, def) {
  try { return JSON.parse(localStorage.getItem(key)) || def; } catch { return def; }
}
function saveData(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

let products = loadData('12clock_products', DEFAULT_PRODUCTS);
let bills = loadData('12clock_bills', []);
let currentBillItems = [];
let activeBillCat = 'all';
let currentDetailBillId = null;

function saveProducts() { saveData('12clock_products', products); }
function saveBills() { saveData('12clock_bills', bills); }

// ── NAVIGATION ──────────────────────────────────────────────

const pageTitles = {
  dashboard: { title: 'Dashboard', sub: 'Overview of today\'s operations' },
  billing: { title: 'New Bill', sub: 'Create and print customer bills' },
  inventory: { title: 'Inventory', sub: 'Track and update stock levels' },
  products: { title: 'Products & Pricing', sub: 'Manage product catalogue and prices' },
  bills: { title: 'Bill History', sub: 'View and reprint saved bills' },
};

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(n => { if (n.getAttribute('onclick')?.includes(id)) n.classList.add('active'); });
  const meta = pageTitles[id];
  document.getElementById('topbarTitle').textContent = meta.title;
  document.getElementById('topbarSub').textContent = meta.sub;
  if (id === 'dashboard') renderDashboard();
  if (id === 'billing') { renderBillingProducts(); renderBill(); }
  if (id === 'inventory') renderInventory();
  if (id === 'products') { renderProductsTable(); renderCatSummary(); }
  if (id === 'bills') renderBillHistory();
  closeSidebar();
}

function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const b = document.getElementById('sidebarBackdrop');
  s.classList.toggle('open');
  b.classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarBackdrop').classList.remove('open');
}

// ── DATE ──────────────────────────────────────────────

function updateDate() {
  const now = new Date();
  const opts = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
  document.getElementById('topbarDate').textContent = now.toLocaleDateString('en-IN', opts);
}
updateDate();

// ── TOAST ──────────────────────────────────────────────

function showToast(msg, type = 'success') {
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = `toast-msg ${type}`;
  t.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-circle-check' : 'fa-circle-xmark'}"></i> ${msg}`;
  c.appendChild(t);
  setTimeout(() => t.remove(), 2800);
}

// ── UTILS ──────────────────────────────────────────────

function genId() { return 'id' + Date.now() + Math.random().toString(36).slice(2, 7); }
function fmtMoney(n) { return '₹' + Number(n).toFixed(2); }
function fmtDate(ts) {
  const d = new Date(ts);
  return d.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' }) + ' ' +
    d.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
}

function getBadgeClass(cat) {
  const m = { 'Cake': 'badge-cake', 'Chocolate': 'badge-choc', 'Ice Cream': 'badge-icecream' };
  return m[cat] || 'badge-cake';
}

function getDotClass(cat) {
  const m = { 'Cake': 'cat-dot-cake', 'Chocolate': 'cat-dot-chocolate', 'Ice Cream': 'cat-dot-icecream' };
  return m[cat] || '';
}

// ── DASHBOARD ──────────────────────────────────────────────

function renderDashboard() {
  const today = new Date().toDateString();
  const todayBills = bills.filter(b => new Date(b.ts).toDateString() === today);
  const revenue = todayBills.reduce((s, b) => s + b.total, 0);
  const itemsSold = todayBills.reduce((s, b) => s + b.items.reduce((a, i) => a + i.qty, 0), 0);

  document.getElementById('stat-revenue').textContent = '₹' + revenue.toFixed(0);
  document.getElementById('stat-bills').textContent = todayBills.length;
  document.getElementById('stat-items').textContent = itemsSold;
  document.getElementById('stat-products').textContent = products.length;

  // Recent bills
  const rec = [...bills].sort((a, b) => b.ts - a.ts).slice(0, 6);
  const rb = document.getElementById('dash-recent-bills');
  if (!rec.length) {
    rb.innerHTML = `<div class="empty-state"><i class="fa-solid fa-receipt"></i><p>No bills yet today</p></div>`;
  } else {
    rb.innerHTML = rec.map(b => `
      <div class="bill-history-item" onclick="openBillDetail('${b.id}')">
        <div class="bill-hist-icon"><i class="fa-solid fa-receipt"></i></div>
        <div class="bill-hist-info">
          <div class="bill-hist-name">${b.customer || 'Walk-in Customer'} <span style="color:var(--text-muted);font-size:11px;">#${b.billNo}</span></div>
          <div class="bill-hist-meta">${b.items.length} item type${b.items.length !== 1 ? 's' : ''} &middot; ${fmtDate(b.ts)}</div>
        </div>
        <div class="bill-hist-amount">${fmtMoney(b.total)}</div>
      </div>
    `).join('');
  }

  // Product catalogue
  const dp = document.getElementById('dash-products');
  dp.innerHTML = products.map(p => `
    <div style="display:flex;align-items:center;padding:10px 16px;border-bottom:1px solid var(--border-light);gap:10px;" class="bill-history-item">
      <span class="cat-dot ${getDotClass(p.category)}"></span>
      <div style="flex:1;font-family:var(--font-body);font-size:13px;color:var(--text-primary);">${p.name}</div>
      <span class="badge-sku ${getBadgeClass(p.category)}">${p.category}</span>
      <div style="font-family:var(--font-display);font-size:13px;font-weight:700;min-width:50px;text-align:right;">${fmtMoney(p.price)}</div>
    </div>
  `).join('');
}

// ── BILLING ──────────────────────────────────────────────

function renderBillingProducts() {
  // Category filter chips
  const cats = ['all', ...new Set(products.map(p => p.category))];
  const fc = document.getElementById('bill-cat-filter');
  fc.innerHTML = cats.map(c =>
    `<div class="cat-chip ${c === activeBillCat ? 'active' : ''}" data-cat="${c}" onclick="setBillCat('${c}')">${c === 'all' ? 'All' : c}</div>`
  ).join('');

  // Products
  const filtered = activeBillCat === 'all' ? products : products.filter(p => p.category === activeBillCat);
  const grid = document.getElementById('product-grid');
  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><i class="fa-solid fa-tag"></i><p>No products found</p></div>`;
    return;
  }
  grid.innerHTML = filtered.map(p => `
    <div class="product-btn" onclick="addToBill('${p.id}')">
      <div class="p-cat">${p.category}</div>
      <div class="p-name">${p.name}</div>
      <div class="p-price">${fmtMoney(p.price)} <span>/ ${p.unit}</span></div>
    </div>
  `).join('');
}

function setBillCat(cat) {
  activeBillCat = cat;
  renderBillingProducts();
}

function addToBill(pid) {
  const product = products.find(p => p.id === pid);
  if (!product) return;
  const existing = currentBillItems.find(i => i.pid === pid);
  if (existing) { existing.qty++; } else {
    currentBillItems.push({ pid, name: product.name, price: product.price, qty: 1, unit: product.unit });
  }
  renderBill();
}

function changeQty(pid, delta) {
  const item = currentBillItems.find(i => i.pid === pid);
  if (!item) return;
  item.qty += delta;
  if (item.qty <= 0) currentBillItems = currentBillItems.filter(i => i.pid !== pid);
  renderBill();
}

function removeFromBill(pid) {
  currentBillItems = currentBillItems.filter(i => i.pid !== pid);
  renderBill();
}

function clearBill() {
  currentBillItems = [];
  document.getElementById('cust-name').value = '';
  document.getElementById('cust-phone').value = '';
  renderBill();
}

function renderBill() {
  const container = document.getElementById('bill-items');
  const empty = document.getElementById('bill-empty');
  const total = currentBillItems.reduce((s, i) => s + i.price * i.qty, 0);

  // Bill number display
  const nextNo = (bills.length + 1).toString().padStart(3, '0');
  document.getElementById('bill-no-display').textContent = '#' + nextNo;

  if (!currentBillItems.length) {
    container.innerHTML = `<div class="empty-state"><i class="fa-solid fa-bag-shopping"></i><p>No items added yet</p></div>`;
  } else {
    container.innerHTML = currentBillItems.map(item => `
      <div class="bill-row">
        <div class="bill-row-name">
          ${item.name}
          <div style="font-size:11px;color:var(--text-muted);font-family:var(--font-ui);">${fmtMoney(item.price)} / ${item.unit}</div>
        </div>
        <div class="bill-row-qty">
          <div class="qty-btn" onclick="changeQty('${item.pid}',-1)"><i class="fa-solid fa-minus" style="font-size:9px;"></i></div>
          <span class="qty-val">${item.qty}</span>
          <div class="qty-btn" onclick="changeQty('${item.pid}',1)"><i class="fa-solid fa-plus" style="font-size:9px;"></i></div>
        </div>
        <div class="bill-row-total">${fmtMoney(item.price * item.qty)}</div>
        <button class="bill-row-del" onclick="removeFromBill('${item.pid}')"><i class="fa-solid fa-xmark"></i></button>
      </div>
    `).join('');
  }

  document.getElementById('bill-total').textContent = total.toFixed(2);
}

function saveBillAndPrint() {
  if (!currentBillItems.length) { showToast('Add at least one item to bill', 'error'); return; }

  const billNo = (bills.length + 1).toString().padStart(3, '0');
  const customer = document.getElementById('cust-name').value.trim() || 'Walk-in Customer';
  const phone = document.getElementById('cust-phone').value.trim();
  const total = currentBillItems.reduce((s, i) => s + i.price * i.qty, 0);

  const bill = {
    id: genId(),
    billNo,
    customer, phone, total,
    items: JSON.parse(JSON.stringify(currentBillItems)),
    ts: Date.now()
  };

  bills.push(bill);
  saveBills();

  // Deduct stock
  bill.items.forEach(item => {
    const p = products.find(p => p.id === item.pid);
    if (p) {
      p.stock = Math.max(0, (p.stock || 0) - item.qty);
    }
  });
  saveProducts();

  showToast(`Bill #${billNo} saved successfully`);
  printBill(bill);
  clearBill();
}

// ── INVENTORY ──────────────────────────────────────────────

function renderInventory() {
  const search = document.getElementById('inv-search').value.toLowerCase();
  const cat = document.getElementById('inv-cat-filter').value;
  let data = products;
  if (search) data = data.filter(p => p.name.toLowerCase().includes(search));
  if (cat !== 'all') data = data.filter(p => p.category === cat);

  const tbody = document.getElementById('inventory-tbody');
  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><i class="fa-solid fa-box-open"></i><p>No products found</p></div></td></tr>`;
    return;
  }

  tbody.innerHTML = data.map(p => {
    const stock = p.stock || 0;
    const val = stock * p.price;
    let status = '';
    if (stock === 0) status = `<span class="badge-sku" style="background:#fff0ee;color:var(--danger);border:1px solid #ffd5cf;">Out of Stock</span>`;
    else if (stock < 5) status = `<span class="badge-sku" style="background:#fef9e7;color:var(--warning);border:1px solid #fce5b0;">Low Stock</span>`;
    else status = `<span class="badge-sku" style="background:#edfaf3;color:var(--success);border:1px solid #c5edd8;">In Stock</span>`;

    return `
      <tr>
        <td><div style="font-family:var(--font-body);font-size:13.5px;font-weight:500;">${p.name}</div></td>
        <td><span class="badge-sku ${getBadgeClass(p.category)}">${p.category}</span></td>
        <td><span style="font-family:var(--font-display);font-weight:600;">${fmtMoney(p.price)}</span> <span style="font-size:11px;color:var(--text-muted);">/${p.unit}</span></td>
        <td><span style="font-family:var(--font-display);font-size:16px;font-weight:700;">${stock}</span></td>
        <td><span style="font-family:var(--font-body);font-size:13px;">${fmtMoney(val)}</span></td>
        <td>${status}</td>
        <td>
          <button class="btn-sku btn-sku-secondary btn-sku-sm" onclick="openUpdateStockModalFor('${p.id}')">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
        </td>
      </tr>
    `;
  }).join('');
}

function openUpdateStockModal() {
  const sel = document.getElementById('stock-prod-select');
  sel.innerHTML = products.map(p => `<option value="${p.id}">${p.name} (${p.category}) — Current: ${p.stock||0}</option>`).join('');
  document.getElementById('stock-qty').value = '';
  document.getElementById('stockModal').classList.add('open');
}

function openUpdateStockModalFor(pid) {
  openUpdateStockModal();
  document.getElementById('stock-prod-select').value = pid;
}

function closeStockModal() { document.getElementById('stockModal').classList.remove('open'); }

function saveStock() {
  const pid = document.getElementById('stock-prod-select').value;
  const type = document.getElementById('stock-type').value;
  const qty = parseInt(document.getElementById('stock-qty').value);
  if (isNaN(qty) || qty < 0) { showToast('Enter a valid quantity', 'error'); return; }
  const p = products.find(p => p.id === pid);
  if (!p) return;
  if (type === 'add') p.stock = (p.stock || 0) + qty;
  else if (type === 'set') p.stock = qty;
  else if (type === 'remove') p.stock = Math.max(0, (p.stock || 0) - qty);
  saveProducts();
  closeStockModal();
  renderInventory();
  showToast(`Stock updated for ${p.name}`);
}

// ── PRODUCTS ──────────────────────────────────────────────

function renderProductsTable() {
  const search = document.getElementById('prod-search').value.toLowerCase();
  let data = products;
  if (search) data = data.filter(p => p.name.toLowerCase().includes(search) || p.category.toLowerCase().includes(search));

  const tbody = document.getElementById('products-tbody');
  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><i class="fa-solid fa-tag"></i><p>No products found</p></div></td></tr>`;
    return;
  }

  tbody.innerHTML = data.map(p => `
    <tr>
      <td>
        <div style="font-family:var(--font-body);font-size:13.5px;font-weight:500;">${p.name}</div>
      </td>
      <td><span class="badge-sku ${getBadgeClass(p.category)}">${p.category}</span></td>
      <td><span style="font-size:12px;color:var(--text-muted);font-family:var(--font-ui);">Per ${p.unit}</span></td>
      <td><span style="font-family:var(--font-display);font-size:15px;font-weight:700;">${fmtMoney(p.price)}</span></td>
      <td>
        <div style="display:flex;gap:6px;">
          <button class="btn-sku btn-sku-secondary btn-sku-sm" onclick="openProductModal('${p.id}')">
            <i class="fa-solid fa-pen"></i>
          </button>
          <button class="btn-sku btn-sku-danger btn-sku-sm" onclick="deleteProduct('${p.id}')">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

function renderCatSummary() {
  const cats = {};
  products.forEach(p => {
    if (!cats[p.category]) cats[p.category] = { count: 0, minPrice: Infinity, maxPrice: 0 };
    cats[p.category].count++;
    cats[p.category].minPrice = Math.min(cats[p.category].minPrice, p.price);
    cats[p.category].maxPrice = Math.max(cats[p.category].maxPrice, p.price);
  });
  const el = document.getElementById('cat-summary');
  el.innerHTML = Object.entries(cats).map(([cat, info]) => `
    <div style="display:flex;align-items:center;gap:10px;padding:12px 0;border-bottom:1px solid var(--border-light);">
      <span class="cat-dot ${getDotClass(cat)}" style="width:9px;height:9px;flex-shrink:0;"></span>
      <div style="flex:1">
        <div style="font-family:var(--font-body);font-size:13px;font-weight:500;">${cat}</div>
        <div style="font-family:var(--font-ui);font-size:11px;color:var(--text-muted);">${info.count} product${info.count!==1?'s':''} &middot; ${fmtMoney(info.minPrice)}–${fmtMoney(info.maxPrice)}</div>
      </div>
    </div>
  `).join('');
}

function openProductModal(id = null) {
  const modal = document.getElementById('productModal');
  document.getElementById('productModalTitle').textContent = id ? 'Edit Product' : 'Add New Product';
  document.getElementById('edit-product-id').value = id || '';
  if (id) {
    const p = products.find(p => p.id === id);
    if (p) {
      document.getElementById('prod-name-input').value = p.name;
      document.getElementById('prod-cat-input').value = p.category;
      document.getElementById('prod-unit-input').value = p.unit;
      document.getElementById('prod-price-input').value = p.price;
      document.getElementById('prod-stock-input').value = p.stock || 0;
    }
  } else {
    document.getElementById('prod-name-input').value = '';
    document.getElementById('prod-price-input').value = '';
    document.getElementById('prod-stock-input').value = '0';
  }
  modal.classList.add('open');
}

function closeProductModal() { document.getElementById('productModal').classList.remove('open'); }

function saveProduct() {
  const id = document.getElementById('edit-product-id').value;
  const name = document.getElementById('prod-name-input').value.trim();
  const cat = document.getElementById('prod-cat-input').value;
  const unit = document.getElementById('prod-unit-input').value;
  const price = parseFloat(document.getElementById('prod-price-input').value);
  const stock = parseInt(document.getElementById('prod-stock-input').value) || 0;

  if (!name) { showToast('Enter a product name', 'error'); return; }
  if (isNaN(price) || price < 0) { showToast('Enter a valid price', 'error'); return; }

  if (id) {
    const p = products.find(p => p.id === id);
    if (p) { p.name = name; p.category = cat; p.unit = unit; p.price = price; p.stock = stock; }
    showToast(`${name} updated`);
  } else {
    products.push({ id: genId(), name, category: cat, unit, price, stock });
    showToast(`${name} added`);
  }

  saveProducts();
  closeProductModal();
  renderProductsTable();
  renderCatSummary();
}

function deleteProduct(id) {
  const p = products.find(p => p.id === id);
  if (!confirm(`Delete "${p?.name}"? This cannot be undone.`)) return;
  products = products.filter(p => p.id !== id);
  saveProducts();
  renderProductsTable();
  renderCatSummary();
  showToast(`Product deleted`, 'error');
}

// ── BILL HISTORY ──────────────────────────────────────────────

function renderBillHistory() {
  const search = document.getElementById('bill-hist-search').value.toLowerCase();
  let data = [...bills].sort((a, b) => b.ts - a.ts);
  if (search) data = data.filter(b =>
    (b.customer || '').toLowerCase().includes(search) ||
    b.billNo.includes(search)
  );

  const tbody = document.getElementById('bills-tbody');
  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><i class="fa-solid fa-receipt"></i><p>No bills found</p></div></td></tr>`;
    return;
  }

  tbody.innerHTML = data.map(b => `
    <tr>
      <td><span style="font-family:var(--font-display);font-weight:700;font-size:13px;">#${b.billNo}</span></td>
      <td>
        <div style="font-family:var(--font-body);font-size:13px;font-weight:500;">${b.customer}</div>
        ${b.phone ? '<div style="font-size:11px;color:var(--text-muted);font-family:var(--font-ui);">' + b.phone + '</div>' : ''}
      </td>
      <td>
        <span style="font-family:var(--font-body);font-size:13px;">${b.items.length} type${b.items.length!==1?'s':''}</span>
        <span style="font-size:11px;color:var(--text-muted);font-family:var(--font-ui);"> (${b.items.reduce((s,i)=>s+i.qty,0)} pcs)</span>
      </td>
      <td><span style="font-family:var(--font-display);font-size:15px;font-weight:700;">${fmtMoney(b.total)}</span></td>
      <td><span style="font-family:var(--font-ui);font-size:12px;color:var(--text-muted);">${fmtDate(b.ts)}</span></td>
      <td>
        <div style="display:flex;gap:6px;">
          <button class="btn-sku btn-sku-secondary btn-sku-sm" onclick="openBillDetail('${b.id}')">
            <i class="fa-solid fa-eye"></i>
          </button>
          <button class="btn-sku btn-sku-success btn-sku-sm" onclick="printBillById('${b.id}')">
            <i class="fa-solid fa-print"></i>
          </button>
          <button class="btn-sku btn-sku-danger btn-sku-sm" onclick="deleteBill('${b.id}')">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

function deleteBill(id) {
  if (!confirm('Delete this bill?')) return;
  bills = bills.filter(b => b.id !== id);
  saveBills();
  renderBillHistory();
  showToast('Bill deleted', 'error');
}

function confirmClearAllBills() {
  if (!confirm('Clear ALL bill history? This cannot be undone.')) return;
  bills = [];
  saveBills();
  renderBillHistory();
  showToast('All bills cleared', 'error');
}

function openBillDetail(id) {
  const bill = bills.find(b => b.id === id);
  if (!bill) return;
  currentDetailBillId = id;
  const modal = document.getElementById('billDetailModal');

  const itemRows = bill.items.map(item => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border-light);">
      <div>
        <div style="font-family:var(--font-body);font-size:13px;font-weight:500;">${item.name}</div>
        <div style="font-family:var(--font-ui);font-size:11px;color:var(--text-muted);">${fmtMoney(item.price)} × ${item.qty} ${item.unit}</div>
      </div>
      <div style="font-family:var(--font-display);font-size:14px;font-weight:700;">${fmtMoney(item.price * item.qty)}</div>
    </div>
  `).join('');

  document.getElementById('bill-detail-content').innerHTML = `
    <div style="background:var(--bg-sidebar);color:#fff;border-radius:var(--radius-md);padding:16px 20px;margin-bottom:16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-family:var(--font-display);font-size:17px;font-weight:800;">12 O'Clock</div>
          <div style="font-family:var(--font-ui);font-size:10px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.08em;margin-top:2px;">Cake Shop</div>
        </div>
        <div style="text-align:right;">
          <div style="font-family:var(--font-ui);font-size:10px;color:rgba(255,255,255,0.5);">Bill No.</div>
          <div style="font-family:var(--font-display);font-size:18px;font-weight:800;">#${bill.billNo}</div>
        </div>
      </div>
    </div>
    <div style="display:flex;gap:16px;margin-bottom:14px;">
      <div style="flex:1;">
        <div style="font-family:var(--font-ui);font-size:10.5px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:3px;">Customer</div>
        <div style="font-family:var(--font-body);font-size:13.5px;font-weight:500;">${bill.customer}</div>
        ${bill.phone ? '<div style="font-family:var(--font-ui);font-size:12px;color:var(--text-muted);">' + bill.phone + '</div>' : ''}
      </div>
      <div>
        <div style="font-family:var(--font-ui);font-size:10.5px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:3px;">Date</div>
        <div style="font-family:var(--font-ui);font-size:12px;color:var(--text-secondary);">${fmtDate(bill.ts)}</div>
      </div>
    </div>
    <div style="margin-bottom:4px;">${itemRows}</div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding-top:14px;">
      <span style="font-family:var(--font-ui);font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;">Total</span>
      <span style="font-family:var(--font-display);font-size:22px;font-weight:800;">₹${bill.total.toFixed(2)}</span>
    </div>
  `;

  modal.classList.add('open');
}

function closeBillDetail() {
  document.getElementById('billDetailModal').classList.remove('open');
  currentDetailBillId = null;
}

function printCurrentBillDetail() {
  if (currentDetailBillId) printBillById(currentDetailBillId);
}

function printBillById(id) {
  const bill = bills.find(b => b.id === id);
  if (bill) printBill(bill);
}

// ── PRINT ──────────────────────────────────────────────

function printBill(bill) {
  const items = bill.items.map(item => `
    <tr>
      <td style="padding:4px 0;">${item.name}</td>
      <td style="text-align:center;padding:4px 6px;">${item.qty}</td>
      <td style="text-align:right;padding:4px 0;">${fmtMoney(item.price)}</td>
      <td style="text-align:right;padding:4px 0;">${fmtMoney(item.price * item.qty)}</td>
    </tr>
  `).join('');

  const receiptHTML = `
    <html>
    <head>
      <title>Bill #${bill.billNo} - 12 O'Clock Cake Shop</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=Lexend:wght@400;500&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Sora', sans-serif; font-size: 12px; color: #111; background: #fff; padding: 20px; max-width: 320px; margin: 0 auto; }
        .header { text-align: center; border-bottom: 2px solid #111; padding-bottom: 10px; margin-bottom: 12px; }
        .shop-name { font-size: 22px; font-weight: 800; letter-spacing: -0.02em; }
        .shop-sub { font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; color: #555; margin-top: 2px; }
        .bill-meta { display: flex; justify-content: space-between; font-size: 11px; color: #555; margin-bottom: 10px; font-family: 'Lexend', sans-serif; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        thead th { font-size: 10px; text-transform: uppercase; letter-spacing: 0.06em; color: #777; border-bottom: 1px solid #ccc; padding-bottom: 5px; font-family: 'Lexend', sans-serif; }
        .total-row { border-top: 2px solid #111; margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; }
        .total-label { font-family: 'Lexend', sans-serif; font-size: 11px; color: #555; text-transform: uppercase; letter-spacing: 0.06em; }
        .total-val { font-size: 20px; font-weight: 800; }
        .footer { text-align: center; margin-top: 16px; font-size: 10px; color: #aaa; letter-spacing: 0.04em; border-top: 1px dashed #ddd; padding-top: 10px; }
      <\/style>
    <\/head>
    <body>
      <div class="header">
        <div class="shop-name">12 O'Clock</div>
        <div class="shop-sub">Cake Shop</div>
      </div>
      <div class="bill-meta">
        <span>Bill #${bill.billNo}</span>
        <span>${new Date(bill.ts).toLocaleDateString('en-IN', {day:'2-digit',month:'short',year:'numeric'})}</span>
      </div>
      <div style="font-family:'Lexend',sans-serif;font-size:11px;margin-bottom:10px;color:#555;">
        Customer: <strong style="color:#111;">${bill.customer}</strong>
        ${bill.phone ? ' | ' + bill.phone : ''}
      </div>
      <table>
        <thead><tr><th style="text-align:left;">Item</th><th>Qty</th><th style="text-align:right;">Rate</th><th style="text-align:right;">Amt</th></tr></thead>
        <tbody>${items}</tbody>
      </table>
      <div style="border-top:1px solid #ccc;margin-top:8px;padding-top:10px;display:flex;justify-content:space-between;align-items:center;">
        <span style="font-family:'Lexend',sans-serif;font-size:10px;color:#555;text-transform:uppercase;letter-spacing:0.06em;">Total Amount</span>
        <span style="font-size:20px;font-weight:800;">₹${bill.total.toFixed(2)}</span>
      </div>
      <div class="footer">Thank you for visiting!<br>12 O'Clock Cake Shop</div>
    <\/body>
    <\/html>
  `;

  const win = window.open('', '_blank', 'width=400,height=600');
  win.document.write(receiptHTML);
  win.document.close();
  win.focus();
  setTimeout(() => { win.print(); }, 500);
}

// ── CLOSE MODALS ON BACKDROP CLICK ──────────────────────────────────────────────

document.querySelectorAll('.modal-overlay').forEach(mo => {
  mo.addEventListener('click', function(e) {
    if (e.target === this) this.classList.remove('open');
  });
});

// ── INIT ──────────────────────────────────────────────
renderDashboard();
</script>
</body>
</html>